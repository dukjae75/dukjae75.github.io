<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Guardians of Drum Beat</title>
    <meta name="description" content="Real-time drum tempo monitoring app - Advanced pattern matching for ensemble performance">
    <meta name="theme-color" content="#0891b2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- PWA 필수 설정 -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #111827;
            color: white;
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        .container {
            height: 100vh;
            overflow-y: auto;
            padding: 1rem;
            padding-bottom: 2rem;
        }
        
        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-top: env(safe-area-inset-top);
        }
        
        .title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #06b6d4;
            text-align: center;
        }
        
        .calibration-section {
            background: #1f2937;
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #374151;
            margin-bottom: 1.5rem;
        }
        
        .calibration-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .drum-status {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .drum-badge {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .drum-badge.active {
            background: #059669;
            color: white;
        }
        
        .drum-badge.inactive {
            background: #4b5563;
            color: #d1d5db;
        }
        
        .calibration-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        
        .calibration-message {
            font-size: 1.125rem;
            font-weight: bold;
            color: #fbbf24;
            text-align: center;
        }
        
        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background: #374151;
            border-radius: 9999px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #fbbf24;
            border-radius: 9999px;
            transition: width 0.1s;
        }
        
        .btn {
            padding: 0.875rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            min-width: 140px;
        }
        
        .btn-calibrate {
            background: #d97706;
            color: white;
        }
        
        .btn-calibrate:hover {
            background: #b45309;
        }
        
        .btn-calibrate:disabled {
            background: #4b5563;
            cursor: not-allowed;
        }
        
        .main-controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        @media (min-width: 640px) {
            .main-controls {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }
        
        .control-panel {
            background: #1f2937;
            border-radius: 0.75rem;
            padding: 1.25rem;
            border: 1px solid #374151;
        }
        
        .control-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #d1d5db;
        }
        
        .target-input {
            width: 100%;
            background: #374151;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #4b5563;
            text-align: center;
        }
        
        .target-input:focus {
            outline: none;
            border-color: #06b6d4;
        }
        
        .bpm-display {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            color: #10b981;
        }
        
        .accuracy-display {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            color: #10b981;
        }
        
        .accuracy-bar {
            width: 100%;
            background: #374151;
            border-radius: 9999px;
            height: 0.375rem;
            margin-top: 0.75rem;
            overflow: hidden;
        }
        
        .accuracy-fill {
            height: 100%;
            border-radius: 9999px;
            transition: all 300ms;
            background: #10b981;
        }
        
        .monitor-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1.125rem;
            transition: all 300ms;
            border: none;
            cursor: pointer;
            margin: 1.5rem auto;
            min-width: 200px;
            background: #0891b2;
            color: white;
        }
        
        .monitor-button:hover {
            background: #0e7490;
        }
        
        .monitor-button.recording {
            background: #dc2626;
        }
        
        .monitor-button.recording:hover {
            background: #b91c1c;
        }
        
        .monitor-button:disabled {
            background: #4b5563;
            cursor: not-allowed;
        }
        
        .drum-detection {
            background: #1f2937;
            border-radius: 0.75rem;
            padding: 1.25rem;
            border: 1px solid #374151;
            margin-bottom: 1.5rem;
        }
        
        .detection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }
        
        .detection-item {
            text-align: center;
        }
        
        .detection-label {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
        }
        
        .detection-meter {
            height: 4rem;
            background: #374151;
            border-radius: 0.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .detection-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            transition: all 100ms;
            border-radius: 0 0 0.5rem 0.5rem;
        }
        
        .detection-value {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.875rem;
            z-index: 10;
        }
        
        .kick-fill { background: #ef4444; }
        .snare-fill { background: #eab308; }
        .hihat-fill { background: #06b6d4; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: env(safe-area-inset-bottom);
        }
        
        @media (min-width: 640px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .stat-item {
            background: #1f2937;
            border-radius: 0.5rem;
            padding: 1rem;
            border: 1px solid #374151;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.25rem;
            font-weight: bold;
            color: #06b6d4;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }
        
        .install-prompt {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            right: 1rem;
            background: #0891b2;
            padding: 1rem;
            border-radius: 0.75rem;
            display: none;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .install-button {
            background: white;
            color: #0891b2;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .close-button {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            margin-left: 1rem;
        }
        
        /* 모바일 최적화 */
        @media (max-width: 640px) {
            .container {
                padding: 0.75rem;
            }
            
            .title {
                font-size: 1.25rem;
            }
            
            .calibration-section,
            .control-panel,
            .drum-detection {
                padding: 1rem;
            }
            
            .bpm-display {
                font-size: 2rem;
            }
            
            .accuracy-display {
                font-size: 1.75rem;
            }
        }
        
        /* 다크모드 강제 적용 */
        @media (prefers-color-scheme: dark) {
            body {
                color-scheme: dark;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="header">
            <h1 class="title">🛡️ Guardians of Drum Beat</h1>
        </div>

        <!-- 캘리브레이션 섹션 -->
        <div class="calibration-section">
            <div class="calibration-title">
                🎯 Drum Sound Calibration
            </div>
            
            <div class="drum-status">
                <div id="kickStatus" class="drum-badge inactive">Kick Drum</div>
                <div id="snareStatus" class="drum-badge inactive">Snare</div>
                <div id="hihatStatus" class="drum-badge inactive">Hi-Hat</div>
            </div>
            
            <div class="calibration-controls">
                <div id="calibrationMessage" class="calibration-message" style="display: none;">
                    준비 중...
                </div>
                
                <div id="progressContainer" class="progress-bar" style="display: none;">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>
                
                <button id="calibrateBtn" class="btn btn-calibrate">
                    Start Calibration
                </button>
            </div>
        </div>

        <!-- 메인 컨트롤 -->
        <div class="main-controls">
            <div class="control-panel">
                <div class="control-title">
                    🎯 Target BPM
                </div>
                <input type="number" id="targetBpm" class="target-input" value="120" min="60" max="200">
            </div>

            <div class="control-panel">
                <div class="control-title">Current BPM</div>
                <div id="currentBpm" class="bpm-display">0</div>
            </div>

            <div class="control-panel">
                <div class="control-title">Accuracy</div>
                <div id="accuracy" class="accuracy-display">0.0%</div>
                <div class="accuracy-bar">
                    <div id="accuracyFill" class="accuracy-fill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- 모니터링 버튼 -->
        <button id="monitorBtn" class="monitor-button" disabled>
            ▶ Start Monitoring
        </button>

        <!-- 실시간 BPM 트렌드 차트 -->
        <div class="drum-detection" style="margin-bottom: 1.5rem;">
            <div class="control-title">📈 Real-time BPM Trend</div>
            <div style="position: relative; height: 200px; background: #374151; border-radius: 0.5rem; overflow: hidden;">
                <canvas id="bpmChart" style="width: 100%; height: 100%;"></canvas>
                <div id="chartLegend" style="position: absolute; top: 0.5rem; right: 0.5rem; display: flex; gap: 1rem; font-size: 0.75rem;">
                    <div style="display: flex; align-items: center; gap: 0.25rem;">
                        <div style="width: 12px; height: 2px; background: #06b6d4;"></div>
                        <span style="color: #06b6d4;">Target</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.25rem;">
                        <div style="width: 12px; height: 2px; background: #10b981;"></div>
                        <span style="color: #10b981;">Current</span>
                    </div>
                </div>
                <div id="bpmRange" style="position: absolute; bottom: 0.5rem; left: 0.5rem; font-size: 0.75rem; color: #9ca3af;">
                    Range: <span id="minBpm">0</span> - <span id="maxBpm">0</span> BPM
                </div>
            </div>
        </div>

        <!-- 드럼 패턴 감지 -->
        <div class="drum-detection">
            <div class="control-title">Real-time Drum Pattern Detection</div>
            <div class="detection-grid">
                <div class="detection-item">
                    <div class="detection-label">Kick Drum</div>
                    <div class="detection-meter">
                        <div id="kickFill" class="detection-fill kick-fill" style="height: 0%"></div>
                        <div id="kickValue" class="detection-value">0%</div>
                    </div>
                </div>
                <div class="detection-item">
                    <div class="detection-label">Snare</div>
                    <div class="detection-meter">
                        <div id="snareFill" class="detection-fill snare-fill" style="height: 0%"></div>
                        <div id="snareValue" class="detection-value">0%</div>
                    </div>
                </div>
                <div class="detection-item">
                    <div class="detection-label">Hi-Hat</div>
                    <div class="detection-meter">
                        <div id="hihatFill" class="detection-fill hihat-fill" style="height: 0%"></div>
                        <div id="hihatValue" class="detection-value">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 통계 -->
        <div class="stats-grid">
            <div class="stat-item">
                <div id="totalBeats" class="stat-value">0</div>
                <div class="stat-label">Detected Beats</div>
            </div>
            <div class="stat-item">
                <div id="avgBpm" class="stat-value">0</div>
                <div class="stat-label">Average BPM</div>
            </div>
            <div class="stat-item">
                <div id="bpmDiff" class="stat-value">0</div>
                <div class="stat-label">BPM Difference</div>
            </div>
            <div class="stat-item">
                <div id="status" class="stat-value" style="color: #ef4444;">STANDBY</div>
                <div class="stat-label">Status</div>
            </div>
        </div>
    </div>

    <!-- PWA 설치 프롬프트 -->
    <div id="installPrompt" class="install-prompt">
        <span>📱 Install Guardians of Drum Beat on your home screen?</span>
        <div>
            <button id="installButton" class="install-button">Install</button>
            <button id="closePrompt" class="close-button">×</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
